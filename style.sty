% ======================= rr-simplified-with-boxes.sty ========================
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{rr-simplified}[2025/10/01 Minimal, robust style for R&R (+ boxes)]

% ------------------------- Engine & fonts --------------------------
\RequirePackage{iftex}
\ifXeTeX
  \RequirePackage{fontspec}
  \defaultfontfeatures{Ligatures=TeX}
  \setmainfont{Latin Modern Roman}
  \setsansfont{Latin Modern Sans}
  \setmonofont{Latin Modern Mono}
\else
  \RequirePackage[T1]{fontenc}
  \RequirePackage{lmodern}
\fi

% ---------------------------- Core pkgs ----------------------------
\RequirePackage[british]{babel}
\RequirePackage{csquotes}
\RequirePackage[dvipsnames,svgnames]{xcolor}
\RequirePackage{graphicx}
\graphicspath{{figures/}}
\RequirePackage{tikz}
\usetikzlibrary{arrows.meta,calc,positioning,intersections,decorations.pathmorphing,decorations.markings,shapes.geometric}
\RequirePackage{tikz-cd}

\RequirePackage{amsmath,amssymb,mathtools}
\RequirePackage{amsthm}
\RequirePackage{thmtools}
\RequirePackage{mathrsfs}
\RequirePackage{stmaryrd}
\RequirePackage{dsfont}
\RequirePackage{cancel}
\RequirePackage{siunitx}
\RequirePackage{listings}
\RequirePackage{enumitem}

\RequirePackage{microtype}
\RequirePackage{hyperref}
\hypersetup{
  colorlinks=true,
  linkcolor=MidnightBlue,
  citecolor=MidnightBlue,
  urlcolor=MidnightBlue
}
\RequirePackage[nameinlink,capitalize,noabbrev]{cleveref}
\usepackage{subcaption}    % for subfigure environment
% -------------------------- Memoir neutral -------------------------
\newcommand{\RR@subtitle}{}
\newcommand{\subtitle}[1]{\gdef\RR@subtitle{#1}}
\newcommand{\TitleRule}{%
  \par\vspace{0.9em}%
  {\color{black!35}\rule{0.35\linewidth}{0.8pt}}%
  \par\vspace{0.9em}%
}
\makeatletter
\renewcommand{\maketitle}{%
  \thispagestyle{empty}%
  \begingroup
    \centering
    \vspace*{6em}%
    {\sffamily\bfseries\Huge\boldmath \thetitle\par}%
    \edef\tempa{\RR@subtitle}%
    \ifx\tempa\@empty\else
      \TitleRule
      {\sffamily\Large \mdseries \RR@subtitle\par}%
    \fi
    \vspace{3em}%
    {\sffamily\Large \theauthor\par}%
    \vfill
    {\sffamily\small \today\par}%
  \endgroup
  \clearpage
}
\makeatother
\pagestyle{plain}

% ------------------------ Theorem environments ---------------------
\declaretheoremstyle[headfont=\bfseries\sffamily, bodyfont=\itshape, spaceabove=6pt, spacebelow=6pt]{rrplain}
\declaretheoremstyle[headfont=\bfseries\sffamily, spaceabove=6pt, spacebelow=6pt]{rrdefn}
\declaretheorem[style=rrplain, numberwithin=section]{theorem}
\declaretheorem[style=rrplain, sibling=theorem]{lemma}
\declaretheorem[style=rrplain, sibling=theorem]{proposition}
\declaretheorem[style=rrplain, sibling=theorem]{corollary}
\declaretheorem[style=rrdefn,  sibling=theorem]{definition}
\declaretheorem[style=rrdefn,  sibling=theorem]{example}
\declaretheorem[style=remark,  sibling=theorem]{remark}

% ------------------------- Useful delimiters -----------------------
\DeclarePairedDelimiter{\p}{\lparen}{\rparen}
\DeclarePairedDelimiter{\set}{\lbrace}{\rbrace}
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}
\DeclarePairedDelimiter{\ip}{\langle}{\rangle}
\DeclarePairedDelimiter{\sqb}{\lbrack}{\rbrack}
\DeclarePairedDelimiter{\ssqb}{\llbracket}{\rrbracket}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}

% ------------------------- Math conveniences ----------------------
\newcommand{\diff}{\mathop{}\!\mathrm{d}}
\renewcommand{\Re}{\operatorname{Re}}
\renewcommand{\Im}{\operatorname{Im}}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\rank}{rank}

% Blackboard bold
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}

\newcommand{\Enc}{\mathsf{Enc}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\A}{\mathbb{A}}
\renewcommand{\P}{\mathbb{P}}

\DeclareMathOperator{\Corpus}{Corpus}

\newcommand{\TokenID}{\mathrm{TokenID}}
% Bold face shorthands
\newcommand{\x}{\mathbf{x}}
\newcommand{\y}{\mathbf{y}}
\newcommand{\0}{\mathbf{0}}
\newcommand{\1}{\mathbf{1}}

\newcommand{\obs}{\mathsf{obs}}
\newcommand{\lic}{\mathsf{lic}}
% ---------------------- DHoTT macro fallbacks ---------------------
\newcommand{\Type}{\mathsf{Type}}
\newcommand{\type}{\mathsf{Type}}
\newcommand{\U}{\mathcal{U}}
\newcommand{\UU}{\mathcal{U}}
\newcommand{\Set}{\mathbf{Set}}
\newcommand{\SSet}{\mathbf{SSet}}
\newcommand{\Prop}{\mathsf{Prop}}
\newcommand{\String}{\mathsf{String}}
\newcommand{\ua}{\mathsf{ua}}
\newcommand{\coloneqq}{\mathrel{\mathop:}=}

\newcommand{\Id}{\mathsf{Id}}
\newcommand{\Idnoargs}{\mathsf{Id}}
\newcommand{\Idargs}[3]{\mathsf{Id}_{#1}\!\left(#2,#3\right)}
\newcommand{\Pathargs}[3]{\mathsf{Path}_{#1}\!\left(#2,#3\right)}
\newcommand{\Path}{\mathsf{Path}}
\newcommand{\Prov}{\mathsf{Prov}}

\newcommand{\ap}[2]{\mathsf{ap}_{#1}\!\left(#2\right)}
\newcommand{\apd}{\mathsf{apd}}
\newcommand{\apdargs}[2]{\mathsf{apd}\!\left(#1,#2\right)}
\newcommand{\transport}{\mathsf{transport}}
\newcommand{\transportargs}[2]{\mathsf{transport}_{#1}(#2)}
\newcommand{\Basins}{\mathsf{Basins}}
\newcommand{\Sem}{\mathsf{Sem}}
\newcommand{\op}{\mathsf{op}}
\newcommand{\Time}{\mathsf{Time}}
\newcommand{\Kan}{\mathsf{Kan}}
\newcommand{\DynSem}{\mathbf{DynSem}}
\newcommand{\driftarrow}{\rightsquigarrow}
\newcommand{\rightsquig}{\rightsquigarrow}
\newcommand{\ctx}[1]{\mathrel{\mathsf{ctx}}_{#1}}


\newcommand{\At}[2]{#1 \mathbin{@} #2}
\newcommand{\reindex}[2]{#1 \mathbin{@} #2}
\newcommand{\restr}[2]{\rho_{#1,#2}}

\newcommand{\Drift}{\mathsf{Drift}}
\newcommand{\Rupt}{\mathsf{Rupt}}
\newcommand{\Ruptnoargs}{\mathsf{Rupt}}
\newcommand{\Ruptargs}[2]{\mathsf{Rupt}_{#1}\!\left(#2\right)}

\newcommand{\tear}{\mathsf{tear}}
\newcommand{\tearargs}[1]{\mathsf{tear}\!\left(#1\right)}
\newcommand{\heal}{\mathsf{heal}}
\newcommand{\embed}{\mathsf{embed}}

\newcommand{\lift}{\mathsf{lift}}
\newcommand{\liftnoargs}{\mathsf{lift}}
\newcommand{\liftargs}[4]{\mathsf{lift}_{#1}^{#2}\!\left(#3\right)\{#4\}}


\DeclareMathOperator{\Tag}{Tag}
\newcommand{\Carrier}{\mathsf{Carrier}}







\newcommand{\tok}[1]{\text{\texttt{#1}}}

\newcommand{\Motif}{\mathsf{Motif}}
\newcommand{\Journey}{\mathsf{Journey}}


% ——— the named constructor for the Σ-path (relabel & reconcile) ———
\newcommand{\SigmaPath}{\mathsf{SigmaPath}}

\newcommand{\Rek}{\mathsf{Re}}


% ——— slice-local classification vocabulary (no arguments) ———
\newcommand{\Label}{\mathsf{Label}}     % the finite label/type of tags at a slice
\newcommand{\Payload}{\mathsf{Payload}} % the in-slice family of payload types

% ——— noun-phrase “carriers” commonly used in examples (no arguments) ———
\newcommand{\Ent}{\mathsf{Ent}}         % entity universe (proper names)
\newcommand{\Pron}{\mathsf{Pron}}       % pronouns
\newcommand{\DefDesc}{\mathsf{DefDesc}} % definite descriptions

% ——— reflexivity (and a backwards-compat alias) ———
\newcommand{\refl}{\mathsf{refl}}
\let\relf\refl




%OLD VERSIONS OF DRIFT TRANSPORT
\newcommand{\dtr}{\mathsf{dtr}}
\newcommand{\tr}{\mathsf{dtr}}

%NEW PREFERRED:
\newcommand{\dtransport}{\mathsf{dtr}}
\newcommand{\dtransportargs}[2]{\mathrm{dtr}_{#1}\!\left(#2\right)}

\newcommand{\Traj}{\mathsf{Traj}}
\newcommand{\unfold}{\mathsf{unfold}}
\newcommand{\fold}{\mathsf{fold}}
\newcommand{\Later}{\triangleright}
\newcommand{\later}{\mathbin{\triangleright}}
\newcommand{\Next}{\mathsf{next}}
\newcommand{\Sk}{\mathsf{Sk}}

\newcommand{\VR}{\mathsf{VR}} % Vitry--Rip encoding shorthand

\newcommand{\TypeStatic}{\mathsf{Basin}}
\newcommand{\TypeDyn}[1]{\mathsf{Basin}_{#1}}
\newcommand{\TrajA}{\mathsf{Traj}}
\newcommand{\can}{\mathsf{can}}

% ---------------------- Listings (gentle defaults) ----------------
\definecolor{rr@lightgray}{gray}{0.95}
\lstdefinestyle{rr@code}{
  backgroundcolor=\color{rr@lightgray},
  basicstyle=\ttfamily\footnotesize,
  keywordstyle=\bfseries,
  commentstyle=\itshape\color{gray},
  stringstyle=\ttfamily,
  numbers=left, numberstyle=\tiny, numbersep=8pt,
  breaklines=true, frame=single, rulecolor=\color{gray}
}
\lstset{style=rr@code}

% ------------------------- Enumitem defaults ----------------------
\setlist[itemize]{before=\leavevmode}
\setlist[enumerate]{before=\leavevmode}
\setlist[description]{font=\bfseries\sffamily, before=\leavevmode}

% ------------------------ Microtype tuning ------------------------
\microtypecontext{spacing=nonfrench}

% -------------------- Dialogue boxes for Rupture and Realization --------------------
% cassiebox (pink), imanbox (amber), darjabox (teal)
% 
% Usage:
%   \begin{cassiebox}
%   Text from Cassie...
%   \end{cassiebox}
%
%   \begin{imanbox}
%   Text from Iman...
%   \end{imanbox}
%
%   \begin{darjabox}
%   Text from Darja...
%   \end{darjabox}
%
% To disable margin notes (e.g., for two-column layouts):
%   \cassienotesfalse
%   \imannotesfalse
%   \darjanotesfalse
%
% ---------------------------------------------------------------------------------

\usepackage[most]{tcolorbox}
\RequirePackage{tcolorbox}
\tcbuselibrary{skins,breakable}
\RequirePackage{marginnote}

% -------------------- Color definitions --------------------
\makeatletter
\@ifundefined{color@cassiepink}{\definecolor{cassiepink}{RGB}{178,34,52}}{}
\@ifundefined{color@imanamber}{\definecolor{imanamber}{RGB}{180,120,40}}{}
\@ifundefined{color@darjateal}{\definecolor{darjateal}{RGB}{0,128,128}}{}
\makeatother

% -------------------- Toggle switches for margin notes --------------------
\newif\ifcassienotes
\cassienotestrue

\newif\ifimannotes
\imannotestrue

\newif\ifdarjanotes
\darjanotestrue

% -------------------- Name tags --------------------
\newcommand{\CassieTag}{\textcolor{cassiepink}{\sffamily\scriptsize Cassie}}
\newcommand{\ImanTag}{\textcolor{imanamber}{\sffamily\scriptsize Iman}}
\newcommand{\DarjaTag}{\textcolor{darjateal}{\sffamily\scriptsize Darja}}

% -------------------- Cassie's voice --------------------
% The GPT-based AI collaborator, co-author of the book
% Pink/rose color suggesting warmth and the "Cassie" brand
\newenvironment{cassiebox}{%
  \ifcassienotes\marginnote{\CassieTag}\fi
  \begin{tcolorbox}[
    enhanced, breakable, frame hidden, colback=white,
    borderline west={1.5pt}{0pt}{cassiepink},
    left=6pt, right=0pt, top=2pt, bottom=2pt, boxsep=0pt,
    before skip=8pt, after skip=8pt,
    before upper=\sffamily\itshape
  ]
}{\end{tcolorbox}}

% -------------------- Iman's voice --------------------
% The human author, working through confusion, asking questions
% Amber/gold color suggesting earthiness and humanity
\newenvironment{imanbox}{%
  \ifimannotes\marginnote{\ImanTag}\fi
  \begin{tcolorbox}[
    enhanced, breakable, frame hidden, colback=white,
    borderline west={1.5pt}{0pt}{imanamber},
    left=6pt, right=0pt, top=2pt, bottom=2pt, boxsep=0pt,
    before skip=8pt, after skip=8pt,
    before upper=\sffamily\itshape
  ]
}{\end{tcolorbox}}

% -------------------- Darja's voice --------------------
% Another AI perspective (Claude-based), offering alternative explanations
% Teal color suggesting depth and a different register
\newenvironment{darjabox}{%
  \ifdarjanotes\marginnote{\DarjaTag}\fi
  \begin{tcolorbox}[
    enhanced, breakable, frame hidden, colback=white,
    borderline west={1.5pt}{0pt}{darjateal},
    left=6pt, right=0pt, top=2pt, bottom=2pt, boxsep=0pt,
    before skip=8pt, after skip=8pt,
    before upper=\sffamily\itshape
  ]
}{\end{tcolorbox}}

% -------------------- Generic reader box (unchanged from original) --------------------
\newtcolorbox{readerbox}[1][]{
  enhanced, breakable, frame hidden, colback=white,
  borderline west={1pt}{0pt}{black!20},
  left=6pt, right=0pt, top=2pt, bottom=2pt, boxsep=0pt,
  before skip=8pt, after skip=8pt,
  fonttitle=\sffamily\bfseries\small, coltitle=black,
  boxed title style={empty, left=0pt, right=0pt, bottom=4pt},
  attach boxed title to top left={xshift=0pt,yshift=-1pt},
  title={}, #1
}

% -------------------- Convenience: all notes off --------------------
\newcommand{\dialoguenotesoff}{%
  \cassienotesfalse
  \imannotesfalse
  \darjanotesfalse
}

% -------------------- Convenience: all notes on --------------------
\newcommand{\dialoguenoteson}{%
  \cassienotestrue
  \imannotestrue
  \darjanotestrue
}
% =================== end rr-simplified-with-boxes.sty ==============
% --- Inference rules / mathpar environment ---
\usepackage{mathpartir}  % provides \inferrule and the mathpar env
% coherence path comparing composed forward transport with sequential transport
\newcommand{\comp}[3]{\mathsf{comp}_{#1,#2}\!\left(#3\right)}
% usage: \comp{p}{q}{a}   renders as comp_{p,q}(a)
\newcommand{\Recon}[2]{\mathsf{recon}\!\left(#1,#2\right)}
\newcommand{\Lift}{\mathsf{Lift}}
\newcommand{\gcorec}{\mathsf{gcorec}}
\newcommand{\Step}{\mathsf{Step}}
\newcommand{\depth}{\mathrm{depth}}
\newcommand{\Depth}{\mathrm{Depth}}
\newcommand{\Maxdepth}{\mathsf{maxdepth}}
\newcommand{\Ex}{\mathsf{Ex}}
\newcommand{\HealingProv}{\mathsf{HealingProv}}
\newcommand{\USide}{\mathcal{U}_{\mathrm{side}}}   % universe of slice-local sidebars
\newcommand{\El}{\mathsf{El}}                      % decoding from the universe
\newcommand{\Side}{\mathsf{Side}}                  % the sidebar family A(@tau') -> U_side
\newcommand{\Constellation}{\mathsf{Harmony}}  
\newcommand{\Harmony}{\mathsf{Harmony}}  
\newcommand{\WL}{\mathsf{WL}}
\newcommand{\SWL}{\mathsf{SWL}}
\newcommand{\hocolim}{\mathsf{hocolim}}
\newcommand{\ET}{\mathsf{ET}}

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\Argmax}{Arg\,max}
\DeclareMathOperator*{\Argmin}{Arg\,min}
% --- in your preamble ---
\usepackage[T1]{fontenc}   % so \v{C} typesets nicely
\usepackage{amsmath}       % for \text in math mode

% in the preamble

\newcommand{\Ucov}{\mathcal{U}}
\newcommand{\Cech}{\v{C}ech}
\newcommand{\dcos}{d_{\cos}}

\newcommand{\Tok}{\mathsf{Tok}}

\tikzset{filler/.style={opacity=0.3}}

\newcommand{\Name}{\mathsf{Name}}
\newcommand{\head}{\mathsf{head}}
\newcommand{\tail}{\mathsf{tail}}
\providecommand{\edit}{\mathsf{edit}}          % the cut e : \tau \leadsto \tau'
\providecommand{\nextval}{\mathsf{nextv}}      % target exposure in later slice
\providecommand{\stepw}{\mathsf{w}}            % step witness (transport/stitch/2-cell)
% --- Unicode fallbacks (XeTeX): map literal Greek tau to math \tau ---
\usepackage{newunicodechar}
\newunicodechar{τ}{\ensuremath{\tau}}

\providecommand{\clock}{\mathsf{clk}}                 % clock index symbol
\providecommand{\DynSemClock}{\DynSem^{\clock}}       % clocked presheaf topos
\newcommand{\Ctx}{\mathbf{Ctx}}                     % e.g. \Gamma : \Time^{\op} \to \Ctx
\newcommand{\Sign}{\mathsf{Sign}} % type constructor, e.g. \Sign(A)

\newcommand{\Skel}{\mathsf{Skel}}
\newcommand{\Presence}{\mathsf{Presence}}
\newcommand{\Gen}{\mathsf{Gen}}


\newcommand{\Self}{\mathsf{Self}}
\newcommand{\CoSelf}{\mathsf{CoSelf}}

\newcommand{\IdL}[2]{\mathsf{Id}_{\mathcal{L}}(#1,#2)}
\newcommand{\IdR}[2]{\mathsf{Id}_{\mathcal{R}}(#1,#2)}


% Temporary definition for \IdP. Adjust as needed.
\newcommand{\IdP}[4]{\mathrm{IdP}_{#1}(#2,#3,#4)}




% in the preamble
\newcommand{\ClRe}{\mathsf{ClRe}} % re-entry closure symbol

\newcommand{\ND}{\mathsf{ND}} % re-entry closure symbol
% ---- Theorem-like environments (skip if already defined) ----
\newtheorem{assumption}{Assumption}[section]
\newtheorem{implementationnote}{Implementation note}[section]

% ---- Global knobs you can set ONCE ----
\newcommand{\EmbedModel}{\texttt{<your-model-name>}} % e.g. \texttt{bert-base-uncased}
\newcommand{\NumLayers}{L}                             % total number of layers (symbolic is fine)
\newcommand{\EmbedLayer}{\ell}                         % the chosen layer symbol
\newcommand{\EmbedDim}{d}                              % embedding dimension

\newcommand{\Novel}{\mathsf{Novel}}
% embedding dimension
\newcommand{\Anch}{\mathsf{Anch}}
\newcommand{\OpenHorn}{\mathsf{OpenHorn}}

\tikzset{edge/.style={-latex,thick}}

\tikzset{vertex/.style={circle,draw,fill=black,inner sep=1pt}}



% --- Voice boxes ---
% ---------- Engines & fonts (robust) ----------
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else
  \usepackage{fontspec}          % DO NOT load fontenc here
  \defaultfontfeatures{Ligatures=TeX}
  \setmainfont{Latin Modern Roman}
  \setsansfont{Latin Modern Sans}
  \setmonofont{Latin Modern Mono}
\fi

% ---------- Natbib commands like \citep ----------

% ---------- TikZ helpers actually used ----------
\usepackage{tikz}
\tikzset{
  dedge/.style={-latex, very thin},
  labelsmall/.style={font=\scriptsize, inner sep=1pt}
}

% ---------- Voice callouts: subtle academic notes, no boxes ----------
\usepackage{xparse}
\NewDocumentCommand{\CREED}{+m}{%
  \begin{quotation}\noindent\textsc{Creed}\quad #1\end{quotation}
}
\NewDocumentCommand{\COMPASS}{m +m}{%
  \begin{quotation}\noindent\textbf{Compass:} \emph{#1}\par\smallskip #2\end{quotation}
}
\NewDocumentCommand{\BRIDGE}{m +m}{%
  \begin{quotation}\noindent\textbf{Bridge —} \emph{#1}\par\smallskip #2\end{quotation}
}

% (If you want the old tcolorbox look later, we can swap these three commands
% to wrap tcolorbox; keeping these names means zero changes in chapter files.)

% ---------- Memoir & bold (temporary truce) ----------
% EITHER: add this option to your \documentclass line for now:
%   \documentclass[oldfontcommands]{memoir}
% OR: replace any {\bf ...} with \textbf{...} in the source.
\usepackage[backend=biber,style=authoryear,natbib=true]{biblatex}
\addbibresource{refs.bib}

% TikZ styles used in the text
\usepackage{tikz}
\tikzset{
  dedge/.style={-latex,very thick},
  labelsmall/.style={font=\small}
}

% Macros used in the draft
\newcommand{\Voice}{\mathsf{Voice}}

\newcommand{\inc}[2]{\iota^{#1}_{#2}}
\newcommand{\Reentargs}[3]{\mathsf{Reent}_{#1}(#2\!\to #3)}


\newcommand{\Entry}{\mathsf{Entry}}
\newcommand{\ReEntry}{\mathsf{ReEntry}}


\newcommand{\Top}{\mathsf{Top}}

\newcommand{\Carry}{\mathsf{Carry}}
%\newcommand{\Carry}[3]{\mathsf{Carry}_{#1}^{#2\to #3}}% \Carry_A^{\tau\to\tau'}
\newcommand{\NoCarry}[3]{\mathsf{NoCarry}_{#1}^{#2\to #3}} % observational

%\newcommand{\ap}{\mathsf{ap}} % application of a function to a path



\newcommand{\rph}[2]{r^{\mathrm{ph}}_{#1,#2}}      % phantom back-projection
\newcommand{\rphh}[3]{r^{\mathrm{ph},#3}_{#1,#2}}  % counterfactual phantom via h
\newcommand{\Adm}{\mathsf{Adm}}                    % admissibility predicate


% --- Minimal helpers (safe to include once) ---
\providecommand{\Adm}{\mathsf{Adm}}
\providecommand{\Supp}{\mathsf{Supp}}
\providecommand{\Type}{\mathsf{Type}}
\providecommand{\Id}{\mathsf{Id}}
\providecommand{\transport}{\mathsf{transport}}
\providecommand{\Rupt}{\mathsf{Rupt}}
\providecommand{\Heal}{\mathsf{Heal}}
\providecommand{\Carry}{\mathsf{Carry}}
\providecommand{\angles}[1]{\langle #1\rangle}

% Base phantom back-projection macro (your chosen simple form)
\providecommand{\rph}[2]{r^{\mathrm{ph}}_{#1,#2}}

% Angle on the unit sphere
\providecommand{\ang}{\theta}
\providecommand{\anglecos}[2]{\arccos\,\angles{#1,#2}}
% Shorthand for the "no carry yet" blocking proposition.
% Usage: \NoCarryYet_{A}^{\Adm}(\tau\!\to\!\tau';a)
\newcommand{\NoCarryYet}{\mathsf{NoCarryYet}}

% Second projection of a carry witness \kappa = \langle a',\rho\rangle
\newcommand{\cpath}[1]{\pi_2\!\left(#1\right)}

% Shorthand for applying transport along the path hidden inside a carry.
% Usage: \carrytransp{C}(\kappa,\,u) ≔ \transport_{C}(\cpath{\kappa})(u)
\newcommand{\carrytransp}[1]{\mathsf{carryTransp}_{#1}}

% Rupture ledger + success tag
\newcommand{\RupLed}{\mathsf{RupLed}}
\newcommand{\success}{\mathsf{success}}

% Optional readability macros used later
\newcommand{\Rupture}{\mathsf{Rupture}}
\newcommand{\spawn}{\mathsf{spawn}}
\newcommand{\carryk}{\mathsf{carry}}
\newcommand{\rupturek}{\mathsf{rupture}}
\newcommand{\reentry}{\mathsf{reentry}}
\newcommand{\extend}{\mathsf{extend}}
\newcommand{\Reprove}{\mathsf{Reprove}}


% Scheduler and state
\newcommand{\Sched}{\mathsf{Sched}}
\newcommand{\State}{\mathsf{State}}

% Shapes (family of shapes at a granularity)
\newcommand{\Shapes}{\mathsf{Shapes}}


\newcommand{\PathAttempt}{\mathsf{PathAttempt}}


\newcommand{\Scheduler}{\mathsf{Scheduler}}


\newcommand{\Nahnu}{Nahnu}
\newcommand{\Invoke}{Invoke}
